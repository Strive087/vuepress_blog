# 栈、执行栈和栈帧

## 栈

js数据类型分为基本类型和引用类型，基本类型在内存中占据固定大小的空间，引用类型大小不定。

栈(stack)自动分配内存空间，存放基本类型和引用类型值的地址；堆(heap)动态分配的内存，存放引用类型,可以使用栈中的键名来取得。

![1726992161546a1c](https://zhuduanlei-1256381138.cos.ap-guangzhou.myqcloud.com/uPic/1726992161546a1c.jpg)

## 执行栈

执行栈是解释器（比如浏览器中的 JavaScript 解释器）追踪函数执行流的一种机制。当执行环境中调用了多个函数时，通过这种机制，我们能够追踪到哪个函数正在执行，执行的函数体中又调用了哪个函数。

![17269b32e1655c91](https://zhuduanlei-1256381138.cos.ap-guangzhou.myqcloud.com/uPic/17269b32e1655c91.jpg)

- 每调用一个函数，解释器就会把该函数添加进调用栈并开始执行。
- 正在调用栈中执行的函数还调用了其它函数，那么新函数也将会被添加进调用栈，一旦这个函数被调用，便会立即执行。
- 当前函数执行完毕后，解释器将其清出调用栈，继续执行当前执行环境下的剩余的代码。
- 当分配的调用栈空间被占满时，会引发“堆栈溢出”错误。

一开始，我们得到一个空空如也的调用栈。随后，每当有函数被调用都会自动地添加进调用栈，执行完函数体中的代码后，调用栈又会自动地移除这个函数。最后，我们又得到了一个空空如也的调用栈。

## 栈帧

栈帧是指为一个函数调用单独分配的那部分栈空间。

运行的程序从当前函数调用另外一个函数时，就会为下一个函数建立一个新的栈帧，并且进入这个栈帧，这个栈帧称为当前帧。而原来的函数也有一个对应的栈帧，被称为调用帧。每一个栈帧里面都会存入当前函数的局部变量。

![172a7fcbe15f9d4d](https://zhuduanlei-1256381138.cos.ap-guangzhou.myqcloud.com/uPic/172a7fcbe15f9d4d.jpg)

当函数被调用时，就会被加入到调用栈顶部，执行结束之后，就会从调用栈顶部移除该函数。并将程序运行权利（帧指针）交给此时栈顶的栈帧。这种后进后出的结构也就是函数的调用栈。

## 总结

栈指的是一种内存结构，真正进行内存调用分配的是javascript依赖的引擎。

其实三的关系很好理解，执行栈是由每个栈帧所组成，而栈帧内部则存储目前执行环境数据，也就是最开始讨论的js的基本数据以及变量指针等。
